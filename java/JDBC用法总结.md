#  JDBC用法总结

[TOC]

Statement接口里有两个方法：

void     addBatch(String sql)

将给定的 SQL 命令添加到此 Statement 对象的当前命令列表中。通过调用方法 executeBatch 可以批量执行此列表中的命令。

int[]     executeBatch()

​          将一批命令提交给数据库来执行，如果全部命令执行成功，则返回更新计数组成的数组。

返回：

包含批中每个命令的一个元素的更新计数所组成的数组（数组中的每个元素为：成功处理了命令后，执行命令所影响数据库中行数的更新计数）。数组的元素根据将命令添加到批中的顺序排序。

PreparedStatement接口里：重写了addBatch()的方法，executeBatch()并没有重写

void     addBatch()  <注意：PreparedStatement的addBatch( )没有参数的>

  将一组参数添加到此 PreparedStatement 对象的批处理命令中。

PreparedStatement.addbatch()的使用：

JDBC批量更新pstmt.addBatch();的问题

在数据量越大的时候 越能体现addBatch()的优势

因为数据库的处理速度是非常惊人的 单次吞吐量很大 执行效率极高

addBatch()把若干sql语句装载到一起，然后一次送到数据库执行，执行需要很短的时间

而pstmt.executeUpdate() 是一条一条发往数据库执行的 时间都消耗在数据库连接的传输上面

举个例子可以帮助理解：

我这有一台超大功率的面粉加工机，前者相当于 把所有农户袋装的麦子收集起来用卡车一次送往加工厂 后者相当于农户排好队用同样的卡车一人一人的往加工厂送麦子 麦子加工5分钟完成，但是每个人到工厂就得3小时，我数据库执行效率再高也没用，时间都耗在传输的路上了！！

这就出现了数据传输的性能瓶颈 addBatch就是为解决这样的问题而产生的！

Statement和PreparedStatement的区别就不多废话了,直接说PreparedStatement最重要的addbatch()结构的使用.

1.建立链接,(打电话拨号 )    

   Connection    connection =getConnection();

2.不自动 Commit (瓜子不是一个一个吃,全部剥开放桌子上,然后一口舔了)

connection.setAutoCommit(false);  

3.预编译SQL语句,只编译一回哦,效率高啊.(发明一个剥瓜子的方法,以后不要总想怎么剥瓜子好.就这样剥.)

PreparedStatement statement = connection.prepareStatement(“INSERT INTO TABLEX VALUES(?, ?)”);  

4.来一个剥一个,然后放桌子上

//记录1

statement.setInt(1, 1);

statement.setString(2, “Cujo”);

statement.addBatch();//把这条执行语句加到PreparedStatement对象的批处理命令中

//记录2

statement.setInt(1, 2);

statement.setString(2, “Fred”);

statement.addBatch();//把这条执行语句加到PreparedStatement对象的批处理命令中

//记录3

statement.setInt(1, 3);

statement.setString(2, “Mark”);

statement.addBatch(); //把这条执行语句加到PreparedStatement对象的批处理命令中 

//批量执行上面3条语句. 一口吞了,很爽

int [] counts = statement.executeBatch();//把以上添加到批处理命令中的所有命令一次过提交给数据库来执行 

//Commit it 咽下去,到肚子(DB)里面

connection.commit();

关于两个prepareStatement方法的区别：两者都是创建一个 PreparedStatement 对象来将参数化的 SQL 语句发送到数据库，区别仅仅在于，第二个PreparedStatement 对象有个ResultSet  getGeneratedKeys();方法可以返回执行Statement对象而创建的任何自动生成的键（主要是自增的键）的结果集

PreparedStatement

prepareStatement(String sql)

创建一个 PreparedStatement 对象来将参数化的 SQL 语句发送到数据库。

PreparedStatement

prepareStatement(String sql,int autoGeneratedKeys)

创建一个默认 PreparedStatement 对象，该对象能获取自动生成的键。