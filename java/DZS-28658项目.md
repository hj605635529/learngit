# DZS-28658项目

Caused by: com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'from
	     channel_promotion_rules
	     where
	     start_valid_time <= '2018-0' at line 6
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method) ~[na:1.8.0_161]
	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62) ~[na:1.8.0_161]
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45) ~[na:1.8.0_161]
	at java.lang.reflect.Constructor.newInstance(Constructor.java:423) ~[na:1.8.0_161]

出现这种问题可能是select查询的时候，最后一个字段加了逗号

```
public static String getPositionValue(String bucket, SceneSearch sceneSearch) {
   Map<String, Map<SceneSearch, String>> positionMap = config.current();
   if (MapUtils.isEmpty(positionMap)) {
      return "";
   }

   if (!positionMap.containsKey(bucket)) {
      return "";
   }

   return Optional.ofNullable(positionMap.get(bucket).get(sceneSearch)).orElse("");
}

public static List<Integer> getPosition(String bucket, SceneSearch sceneSearch) {
   List<Integer> positions = Splitter.on(",").splitToList(getPositionValue(bucket, sceneSearch)).stream()
         .filter(NumberUtils::isDigits).map(Integer::valueOf).collect(Collectors.toList());
   Collections.sort(positions);
   return positions;
}
```



```java
List<BaseHotel> hotels = HourlyGenerateHotelsService.generateHotels(items, requestParam.getRequest());
```

```
public class HomePageCardServlet extends BaseHttpServlet {
```





```
List<HotelItem> buildHighStar(List<HotelItem> hotelList) {

    try {
        long t = System.currentTimeMillis();
      List<HotelItem> qualifiedItems = qualifyCandidates(hotelList, highStarHotelPredicate);
      if (CollectionUtils.isEmpty(qualifiedItems)) {
         return emptyList();
      }

      if (!isQuantityQualified(qualifiedItems)) {
         qualifiedItems = supply(hotelList, qualifiedItems);
      }

      List<HotelItem> result = adjust(qualifiedItems, highStarSpecialHotelFinder);

      long cost = System.currentTimeMillis() - t;
      log.info("HOME_PAGE_HIGH_STAR_BUILD_SUCCESS cost {}ms", cost);
      QMonitor.recordOne("HOME_PAGE_HIGH_STAR_BUILD_SUCCESS", cost);

      return result;
   } catch (Exception e) {
       log.error("HOME_PAGE_HIGH_STAR_BUILD_FAILED", e);
       QMonitor.recordOne("HOME_PAGE_HIGH_STAR_BUILD_FAILED");
      return emptyList();
   }
}
```

```
HomePageCardProcessor
```

